// scripts/test-live-oauth.js
// Live test of Google OAuth integration

console.log("üß™ Live Google OAuth Test");
console.log("=" .repeat(40));

// Test URLs generated by diagnostic
const testUrls = {
  manual: "https://accounts.google.com/o/oauth2/v2/auth?client_id=389790994997-qcla9r90kd25v9j46n6qj9je54o2dn6q9ge5g4c2dn2.apps.googleusercontent.com&redirect_uri=https%3A%2F%2Fwdprvtqbwnhwbpufcmgg.supabase.co%2Fauth%2Fv1%2Fcallback&response_type=code&scope=email+profile",
  supabase: "https://wdprvtqbwnhwbpufcmgg.supabase.co/auth/v1/authorize?provider=google&redirect_to=http%3A%2F%2Flocalhost%3A8081%2F"
};

console.log("\nüîó Test URLs:");
console.log("1. Direct Google OAuth URL:");
console.log(`   ${testUrls.manual}`);
console.log("\n2. Supabase OAuth URL:");
console.log(`   ${testUrls.supabase}`);

console.log("\nüìã Test Instructions:");
console.log("1. Open your application at http://localhost:8081/");
console.log("2. Try to sign in with Google");
console.log("3. If it fails, try the direct URLs above");
console.log("4. Check browser console for any errors");

console.log("\n‚úÖ Configuration Summary:");
console.log("- Client ID: 389790994997-qcla9r90kd25v9j46n6qj9je54o2dn6q9ge5g4c2dn2.apps.googleusercontent.com");
console.log("- Redirect URI: https://wdprvtqbwnhwbpufcmgg.supabase.co/auth/v1/callback");
console.log("- OAuth Consent Screen: Published");
console.log("- All configurations appear correct");

console.log("\nüéØ If OAuth still fails:");
console.log("1. Check browser network tab for 401 errors");
console.log("2. Verify the Client Secret in Supabase Dashboard matches Google Cloud Console");
console.log("3. Ensure all redirect URIs are exactly configured in Google Cloud Console");
console.log("4. Check if OAuth consent screen is still published");

async function testOAuthEndpoints() {
  console.log("\nüîç Testing OAuth endpoints...");
  
  try {
    // Test Supabase endpoint
    const supabaseResponse = await fetch(testUrls.supabase, {
      method: "HEAD",
      redirect: "manual"
    });
    
    console.log(`Supabase OAuth endpoint: ${supabaseResponse.status} ${supabaseResponse.status === 302 ? '‚úÖ' : '‚ùå'}`);
    
    // Test Google endpoint
    const googleResponse = await fetch(testUrls.manual, {
      method: "HEAD", 
      redirect: "manual"
    });
    
    console.log(`Google OAuth endpoint: ${googleResponse.status} ${googleResponse.status === 302 ? '‚úÖ' : '‚ùå'}`);
    
  } catch (error) {
    console.log(`‚ùå Error testing endpoints: ${error.message}`);
  }
}

testOAuthEndpoints(); 